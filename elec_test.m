if ~exist('cpct')
%     cpct = loadMonthlyData('E:\data\udel\output\air\monthly\1900-2014', 'air', 'startYear', 2000, 'endYear', 2014);
%     cpct = {flipud(cpct{1}), cpct{2}, cpct{3}};
    lat = [];
    lon = [];
    cpct = [];
    for y = 2000:2017
        fprintf('loading %d...\n', y);
        cpctmaxDaily = loadDailyData('E:\data\cpc-temp\output\tmax', 'startYear', y, 'endYear', y);
        if length(lat) == 0
            lat = cpctmaxDaily{1};
            lon = cpctmaxDaily{2};
        end
        
        cpctminDaily = loadDailyData('E:\data\cpc-temp\output\tmin', 'startYear', y, 'endYear', y);
        
        cpctmaxMonthly = dailyToMonthly(cpctmaxDaily);
        cpctminMonthly = dailyToMonthly(cpctminDaily);
        
        cpct(:,:,y-2000+1,:) = (cpctmaxMonthly{3} + cpctminMonthly{3}) ./ 2;
        
        clear cpctmaxDaily cpctminDaily;
    end
    

end

elecUs = [327718	294305	297826	281266	315839	335602	359246	373613	323805	301598	300836	338813	336691	286144	303369	280950	306245	330042	360429	372942	307116	293341	276754	304650	325100	285914	306469	294059	311380	346368	388760	381236	336068	311185	299932	328257	346408	303265	306863	289027	310846	332464	380945	387704	325964	307370	299686	334713	349541	316599	310618	293253	330843	349227	383642	375330	339652	316117	306138	346172	347608	302476	322003	293141	319170	368293	408488	411854	355214	320780	310200	352954	333350.683	311513.776	322760.422	301845.599	334849.719	368924.784	416756.11	414370.605	334705.436	324039.993	311912.979	341184.896	358400.108	329131.318	326068.782	308486.872	337077.406	369027.088	399942.677	427923.77	359235.836	336960.713	318875.047	350675.386	373545.221	329533.386	328971.234	309967.091	330618.639	379358.505	410208.259	395457.48	343227.944	322165.867	313595.687	348264.688	360180.329	305955.52	314024.627	293779.378	317249.445	353833.926	378736.762	387911.189	332059.864	312134.923	300965.602	355981.438	369085.645	325801.288	317818.147	292983.448	333710.539	383454.41	417587.201	414852.879	349115.159	309798.698	307831.601	362895.984	369896.282	318007.518	323992.626	307431.985	331031.926	374678.289	427506.456	414177.96	343125.452	314224.861	308124.52	341201.126	345792.941	314014.005	313267.98	300741.534	343752.866	367928.935	424705.309	404017.194	340722.106	317766.441	311780.899	339922.791	355746.309	316161.11	332691.899	304688.105	330280.021	365204.002	403237.043	393889.997	348069.012	321811.892	321045.051	359578.559	385248.805	329966.704	338521.722	302692.836	330718.682	365685.588	393941.032	393329.851	347308.506	320866.957	324528.981	343955.339	368396.389	342626.528	332110.201	302029.374	330947.15	371607.417	410256.669	402207.386	358823.317	318448.121	307230.511	331205.937	360609.494	320693.04	310770.325	298760.094	324971.613	377944.771	423234.303	421403.688	360531.073	320503.916	305616.334	354678.349	349943.196	296794.923	328379.792	301820.406	329891.147	367316.411	412300.198	391387.655	341536.692	326476.061	313691.095	353456.128];
elecAus = [15947	15941	15920	16370	16362	16376	17060	17050	17039	15848	15848	15849	17160	17154	17124	16910	16901	16922	17306	17292	17279	16751	16715	16734	17353	17339	17288	17575	17557	17590	18241	18219	18199	17440	17383	17418	17579	17571	17529	17486	17474	17503	18428	18407	18386	17481	17428	17455	18601	18586	18528	18515	18495	18529	18979	18953	18927	17743	17679	17710	19389	19374	19308	19288	19268	19312	19599	19569	19541	19165	19088	19129	18578.459	18571.788	18530.348	18513.2	18503.961	18544.798	19563.461	19540.359	19517.577	18805.545	18728.694	18785.081	19090.456	18732.643	18664.434	18544.123	18522.462	18571.165	19548.733	19503.027	19457.758	18350.345	18235.023	18294.588	19590.932	19582.523	19502.949	18649.686	18636.992	18720.444	21181.662	21105.847	18779.099	19109.916	18607.464	19346.843	21052.411	18363.348	18635.918	17841.528	19325.898	19338.068	20380.807	19221.722	18203.779	19611.4	22112.551	20455.353	20739.227	19137.652	19473.694	18089.041	19796.108	20162.666	21142.735	21105.796	19778.19	19057.644	18816.968	19325.286	23481.031	20277.274	19911.147	17890.309	19934.423	20018.199	21013.273	20146.965	18561.292	19020.364	19701.167	19028.444	21776.711	19712.254	19616.871	18322.439	19613.598	20066.623	20732.152	20422.434	18352.433	18961.251	18846.957	20085.478	24110.366	18554.604	19604.488	17696.622	19018.646	19136.571	19871.975	19509.997	17972.396	18539.655	18206.767	19140.914	22180.171	19476.418	19669.218	18538.051	19977.317	19538.12	21118.154	20243.594	18121.551	18760.417	19827.877	20761.348	23219.666	18925.745	20814.195	18232.976	19339.881	19167.598	19893.895	19082.33	17602.858	17769.783	18384.327	19676.193	21969.438	22825.183	22018.493	21037.026	20714.112	22288.363	21877.468	20566.532	19138.655	18921.738	19427.323	20000.668	23606.058	22280.335	21100.784	18467.165	20103.405	20766.398	21393.105	20946.341	19178.066	19309.89	19642.302	20390.984];
elecMex = [15069	14581	16161	15652	17411	16519	17539	17903	16985	16260	15108	15175	15786	14564	16584	16116	17583	17585	18046	18353	16978	16521	15302	15194	16589	14811	16387	16970	18143	18077	18159	18520	17378	17461	15737	15568	16770	15870	18275	17487	19643	18657	18731	18488	16663	16006	14930	15213	16728	15840	17780	16739	18354	18229	18938	19498	18109	18353	16598	16807	17412	16401	18237	18921	20110	20844	20859	20666	19998	19290	17928	17946	18780.885	17603.646	20191.065	19689.276	21694.867	22035.135	22408.539	22239.411	20673.918	20802.297	19067.816	19041.146	19418.351	17667.955	20866.896	19756.892	22213.197	22484.692	22656.996	22997.503	21532.13	21687.747	19767.292	19631.348	20385.407	19805.426	20859.928	21907.995	23411.024	23519.758	23084.68	23339.095	21375.542	21391.148	19332.699	18939.3	19034.428	17775.224	20526.518	20430.329	22385.19	22773.661	24235.194	24385.474	22269.122	22219.452	19737.122	20071.287	19971.663	17986.721	21065.875	21528.871	24030.123	24527.686	23726.535	24571.172	22895.346	22086.89	20398.502	20595.617	21189.619	19679.088	23173.424	22795.124	25058.785	24910.046	25718.794	26569.507	24501.79	22932.886	21198.135	21670.801	21984.791	20311.119	23091.27	22662.637	26116.505	26428.837	26016.786	27065.229	24931.239	23859.189	21052.734	21945.662	22273.948	20923.039	22821.424	24311.955	25985.586	26342.866	26224.854	27146.341	24349.455	23998.206	21429.395	21252.931	21630.026	20727.864	23916.261	24017.767	25745.806	26446.828	26971.939	27215.941	24883.677	24813.788	21420.089	21731.013	22509.655	20878.582	23810.652	24289.529	26038.417	26585.819	27420.829	28573.215	26533.203	25727.501	22780.744	21964.852	22208.545	21624.4	23930.179	25476.034	27452.951	27783.591	29049.392	28125.134	26477.784	26105.918	22740.812	21943.256	22957.356	21583.592	25255.706	25155.494	27678.072	28088.712	28695.577	29329.679	25729.508	25545.038	22470.232	22846.299];
elecCad = [54479	49009	47972	43255	42674	41318	41733	42775	41125	43881	46602	56197	54435	50500	50050	43586	42210	41752	42096	43524	40347	43415	45814	49661	52002	49174	50463	44880	44541	42021	45121	43915	43299	45769	48146	52750	57252	51465	52227	45353	42687	41021	43887	43939	41073	44655	47179	52656	59109	51507	51060	44938	43071	41813	43945	43410	42141	45145	48303	55655	57975	50004	52298	45479	44327	44856	46592	46448	43490	45868	49100	55701	55357.261	51379.214	52875.064	45329.979	44331.743	43592.246	46105.119	45215.155	42257.115	45969.193	47971.226	53062.684	56597.897	52841.026	52816.137	46611.286	44093.688	43095.074	44478.737	45003.766	41748.403	45120.203	49448.431	56450.352	57075.907	53886.947	53764.187	46200.053	45139.48	42990.779	45560.664	44515.331	42062.492	45861.388	47832.14	55688.629	59336.512	50085.657	51461.591	44044.889	41392.01	40355.43	41829.237	42546.345	40483.384	45177.96	45850.932	55409.055	56320.883	49949.87	49565.698	43182.644	42939.551	41673.949	44051.315	43372.951	41024.973	44406.424	48460.856	55413.884	59555.993	52353.082	53840.559	46660.337	43940.41	41959.64	45520.085	44899.686	42492.437	44758.842	47866.031	54143.898	56866.202	51105.347	50486.477	44300.031	43140.87	41897.586	44710.258	44268.561	41288.739	46293.42	49545.323	54487.187	58939.31	52079.997	52544.445	47149.786	43887.621	42787.182	45690.191	44787.968	42531.375	46222.692	52159.632	59351.804	61056.991	54610.562	56756.506	48407.757	44677.24	43259.556	45174.985	45245.554	43167.01	45508.512	51500.037	56931.288	61859.827	56446.214	55153.022	47014.26	43097.602	42733.624	45152.941	45117.299	42673.509	45595.9	49220.325	54408.477	57511.001	53770.645	53661.815	48038.22	41819.242	43281.843	43979.334	46472.22	44542.144	45939.187	47982.318	57690.03	56100.541	53812.445	55258.807	47253.322	46615.375	44004.342	46473.793	45212.814	43804.33	45400.279	50497.955	58106.213];

latUs = [25 48];
lonUs = [-124 -65]+360;

latAus = [-39 -12];
lonAus = [113 153];

latMex = [14 31];
lonMex = [-116 -87]+360;

latCad = [47 60];
lonCad = [-126 -67]+360;

[li, loi] = latLonIndexRange({lat,lon,[]}, latCad, lonCad);
elecBase = elecCad';

smoothing = 5*12;

numYears = 18;

elec = elecBase - smooth(elecBase, smoothing);
elec = reshape(elec, [12, numYears]);
elec = elec - nanmean(elec, 2);

t = squeeze(nanmean(nanmean(cpct(li,loi, :, :), 2), 1));
figure;plot(1:12,nanmean(t,1));
t = permute(t, [2, 1]);
t = reshape(t, [numel(t), 1]);
t = t - smooth(t, smoothing);
t = reshape(t, [12, numYears]);
t = t - nanmean(t, 2);

eJJA = elec([6 7 8],:);
eJJA = reshape(eJJA, [3*numYears, 1]);

tJJA = t([6 7 8], :);
tJJA = reshape(tJJA, [3*numYears, 1]);

corr(tJJA,eJJA)
fJJA = fit(tJJA,eJJA,'poly1')
fJJA_ci = confint(fJJA);

eSON = elec([9 10 11],:);
eSON = reshape(eSON, [3*numYears, 1]);

tSON = t([9 10 11], :);
tSON = reshape(tSON, [3*numYears, 1]);

corr(tSON,eSON)
fSON = fit(tSON,eSON,'poly1')
fSON_ci = confint(fSON);

eDJF = elec([12 1 2],:);
eDJF = reshape(eDJF, [3*numYears, 1]);

tDJF = t([12 1 2], :);
tDJF = reshape(tDJF, [3*numYears, 1]);

corr(tDJF,eDJF)
fDJF = fit(tDJF,eDJF,'poly1')
fDJF_ci = confint(fDJF);

eMAM = elec([3 4 5],:);
eMAM = reshape(eMAM, [3*numYears, 1]);

tMAM = t([3 4 5], :);
tMAM = reshape(tMAM, [3*numYears, 1]);

corr(tMAM,eMAM)
fMAM = fit(tMAM,eMAM,'poly1')
fMAM_ci = confint(fMAM);


chgAnn = ((fDJF(1)-fDJF(0))+(fJJA(1)-fJJA(0))+(fSON(1)-fSON(0))+(fMAM(1)-fMAM(0))) / nanmean(nanmean(elecBase)) * 100
chgJJA = (fJJA(1)-fJJA(0)) / nanmean(nanmean(elecBase([6 7 8], :))) * 100
chgJJA_ci = (predint(fJJA, 1, .95)-predint(fJJA, 0, .95)) / nanmean(nanmean(elecBase([6 7 8], :))) * 100
chgSON = (fSON(1)-fSON(0)) / nanmean(nanmean(elecBase([9 10 11], :))) * 100
chgSON_ci = (predint(fSON, 1, .95)-predint(fSON, 0, .95)) / nanmean(nanmean(elecBase([9 10 11], :))) * 100
chgDJF = (fDJF(1)-fDJF(0)) / nanmean(nanmean(elecBase([12 1 2], :))) * 100
chgDJF_ci = (predint(fDJF, 1, .95)-predint(fDJF, 0, .95)) / nanmean(nanmean(elecBase([12 1 2], :))) * 100
chgMAM = (fMAM(1)-fMAM(0)) / nanmean(nanmean(elecBase([3 4 5], :))) * 100
chgMAM_ci = (predint(fMAM, 1, .95)-predint(fMAM, 0, .95)) / nanmean(nanmean(elecBase([3 4 5], :))) * 100

figure('Color', [1,1,1]);
hold on;
axis square;
grid on;
box on;

colorHd = [216, 66, 19]./255.0;

b = bar(1, chgJJA, .5);
set(b, 'facecolor', colorHd);
e = errorbar(1, chgJJA, chgJJA_ci(2)-chgJJA, chgJJA-chgJJA_ci(1));
set(e, 'color', 'k', 'linewidth', 2);
if sign(fJJA_ci(1,1)) == sign(fJJA_ci(2,1))
    %set(b, 'facecolor', colorHd, 'edgecolor', 'k', 'linewidth', 5);
end

b = bar(2, chgSON, .5);
set(b, 'facecolor', colorHd);
e = errorbar(2, chgSON, chgSON_ci(2)-chgSON, chgSON-chgSON_ci(1));
set(e, 'color', 'k', 'linewidth', 2);
if sign(fSON_ci(1,1)) == sign(fSON_ci(2,1))
    %set(b, 'facecolor', colorHd, 'edgecolor', 'k', 'linewidth', 5);
end

b = bar(3, chgDJF, .5);
set(b, 'facecolor', colorHd);
e = errorbar(3, chgDJF, chgDJF_ci(2)-chgDJF, chgDJF-chgDJF_ci(1));
set(e, 'color', 'k', 'linewidth', 2);
if sign(fDJF_ci(1,1)) == sign(fDJF_ci(2,1))
    %set(b, 'facecolor', colorHd, 'edgecolor', 'k', 'linewidth', 5);
end

b = bar(4, chgMAM, .5);
set(b, 'facecolor', colorHd);
e = errorbar(4, chgMAM, chgMAM_ci(2)-chgMAM, chgMAM-chgMAM_ci(1));
set(e, 'color', 'k', 'linewidth', 2);
if sign(fMAM_ci(1,1)) == sign(fMAM_ci(2,1))
    %set(b, 'facecolor', colorHd, 'edgecolor', 'k', 'linewidth', 5);
end


%title('National electricity use - US');
set(gca, 'XTick', [1 2 3 4], 'XTickLabels', {'JJA', 'SON', 'DJF', 'MAM'});
ylabel(['% change per 1' char(176) 'C warming']);
ylim([-1.5 4]);
set(gca, 'fontsize', 36);
set(gcf, 'Position', get(0,'Screensize'));
export_fig(['elec-us.eps']);
close all;